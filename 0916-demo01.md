# 0916 Practice - Demo01

### 開啟Spring Initializr 建立專案  

* 填寫專案相關資訊：Group、Artifact、Name、Package name  
* 引入相關的Dependencies  
* 下方Generate下載專案  

<img width="1112" height="908" alt="{30415199-3063-416E-8AC5-11B86F102E32}" src="https://github.com/user-attachments/assets/3fd3f711-b57b-4bbe-a084-edd2f9883f35" />

### 調整 Project Setting

* 打開 IntelliJ 按 F4 開啟 Project Setting  
<img width="1016" height="405" alt="{2EE4DE28-8EFB-4E8E-BFA5-FC41DA8027D8}" src="https://github.com/user-attachments/assets/97e52aef-b6c1-4199-99dc-98840e6e1f40" />  

* 打開 Setting  
<img width="337" height="263" alt="{2C743E9E-AD5D-49D6-B8CC-994A9D0B07DF}" src="https://github.com/user-attachments/assets/e87276e4-df3c-4438-a4a0-ad6db350a97d" />

* 安裝 兩個Plugin  
<img width="855" height="489" alt="{AAFD0898-53DF-4CA8-97CF-31F7E43D03BF}" src="https://github.com/user-attachments/assets/ac452ac3-ed3b-4691-8209-d0225091ec71" />

* Enable Annotation  
<img width="984" height="735" alt="2025-09-16 10_47_07-Settings" src="https://github.com/user-attachments/assets/3e7398c7-633b-4469-baa4-f82f5ffce342" />

* 重啟 IntelliJ後 ，起Springboot服務
<img width="1185" height="528" alt="2025-09-16 10_48_54-demo1 – Demo1Application java" src="https://github.com/user-attachments/assets/e959eb8e-227a-4685-918b-0ebee4aa1aad" />

* 看到json出現就是有起成功了

http://localhost:8080/actuator  
<img width="651" height="161" alt="{6E84D7E6-D54B-433B-B951-9C7E193D5CB2}" src="https://github.com/user-attachments/assets/f1e53d8d-c234-4ff1-83a2-ac65a86a2a15" />

### 包成docker-image

open terminal inside intelliJ  
* .\mvnw --version  
* .\mvnw dependency:tree  

close intelliJ run process  
* .\mvnw spring-boot:run
* ctrl + C  

包 jar 
* .\mvnw package
*  java -jar .\target\demo1-0.0.1-SNAPSHOT.jar  

check docker desktop is running  
* docker ps  

包 Docker-images   
* .\mvnw spring-boot:build-image  
<img width="646" height="150" alt="{CB13365F-D703-43BC-B1C4-B1DF111271E7}" src="https://github.com/user-attachments/assets/f83f417b-1638-456c-a2f4-08f10f09c575" />  

RUN Docker  
* docker run demo1:0.0.1-SNAPSHOT  
* docker run demo1:0.0.1-SNAPSHOT -d (detach背景run)  
* docker run -d -p 8080:8080 demo1:0.0.1-SNAPSHOT
* docker run -d -p 8888:8080 demo1:0.0.1-SNAPSHOT (前面8888是container的port)  

清除項目在Build過程中產生的東西(通常位於target目錄下)rget 目录下）
* .\mvnw clean

### DemoController

```java
DemoController.java

package com.uuu.demo1;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class DemoController {
    @GetMapping("/")
    public String index() {
        return "it works";
    }
}
```

java自動import(建議非強制)  



### 改使用 @Controller
<img width="984" height="735" alt="2025-09-16 11_55_31-Settings" src="https://github.com/user-attachments/assets/6473806b-aeb0-484d-a6d6-9f8efb30bf29" />

```java
DemoController.java

package com.uuu.demo1.controllers;


import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Controller
public class DemoController {
    @GetMapping("/")
    public String index() {
        return "home";
    }
}
```

templates資料夾下建立一個 home.html
<img width="1075" height="515" alt="2025-09-16 13_14_12-demo1 – DemoController java" src="https://github.com/user-attachments/assets/975d16ff-5c1b-4211-91cb-819fa8258ca0" />

```html
home.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>hello thymeleaf</h1>
</body>
</html>
```

### 放圖檔

圖檔放到images資料夾內 https://www.thymeleaf.org/   
<img width="469" height="527" alt="2025-09-16 13_25_26-demo1 – DemoController java" src="https://github.com/user-attachments/assets/22358dc9-614f-41d0-949a-acf4e35f04dd" />

```html
home.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>hello thymeleaf</h1>
<p>origin</p>
<img src="/images/thymeleaf.png"/>
<p>server side rendering</p>
<img src="/images/thymeleaf.png"/>
</body>
</html>
```
<img width="694" height="932" alt="{A975A801-E0E8-486E-A918-5EA546D7E57E}" src="https://github.com/user-attachments/assets/5b0132eb-69c8-456b-92f2-d7d2ca43dc10" />

### Server side rendering (顯示同前)

```html
home.html

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>hello thymeleaf</h1>
<p>origin</p>
<img src="/images/thymeleaf.png"/>
<p>server side rendering</p>
<img th:src="@{/images/thymeleaf.png}"/>
</body>
</html>
```

### 增加Context Path

```properties
application.properties

spring.application.name=demo1
server.servlet.context-path=/ucom
```

要記得加context-path後面那段，才會找到服務  
<img width="855" height="227" alt="{DAC31517-D5E6-4E1F-9B23-0BF5ABD8BD6A}" src="https://github.com/user-attachments/assets/2df53ba3-f867-4639-a324-deb06ae67bee" />

上面的圖片便找不到了  
<img width="838" height="842" alt="{1F6CE399-8E1F-4739-9481-69D85C3CDC01}" src="https://github.com/user-attachments/assets/951f4177-6e7c-49fa-9694-1a415d8228c6" />

server side rendering的會被修正前面路徑  
<img width="548" height="292" alt="{D0F09E0F-93DE-4D78-A976-BF2144BAADCB}" src="https://github.com/user-attachments/assets/8f65dc99-26d3-4bbd-8ab2-e48c735c7d73" />  

### Controller指向有子目錄結構的view

```html
info/contact.html

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>如果有問題請聯絡...人</h1>
</body>
</html>
```

<img width="1138" height="625" alt="2025-09-16 13_58_56-demo1 – DemoController java" src="https://github.com/user-attachments/assets/9518785f-013a-4f30-87a6-1487b1cc444e" />

```java
DemoController.java

@Controller
public class DemoController {
    @GetMapping("/")
    public String home() {
        return "home";
    }
    @GetMapping("/info")
    public String info() {
        return "info/contact";
    }
}
```

<img width="619" height="167" alt="{1BCAE5D7-00BF-40BA-B989-89EB423858A5}" src="https://github.com/user-attachments/assets/14354109-6b43-4a5f-b1b1-780e6d3a7162" />

### 傳入字串至template中

```java
DemoController.java

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;   // Model要import這個
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Controller
public class DemoController {
    private static final String MESSAGE = "message";
    @GetMapping("/")
    public String index(Model model) {
        model.addAttribute(MESSAGE,"Hi, 我是Mark Ho");
        return "home";
    }
    @GetMapping("/info")
    public String info() {
        return "info/contact";
    }
}
```
(IntelliJ import快捷鍵 Alt+Enter)  

```html
home.html

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>hello thymeleaf</h1>
<h2 style="background-color: red;" th:text="${message}"></h2>
<h2 style="background-color: blue;">[[${message}]]</h2>
<hr/>
<h1>not exist key</h1>
<h2 style="background-color: red;" th:text="${message123}"></h2>
<h2 style="background-color: blue;">[[${message123}]]</h2>

<hr/>
<p>origin</p>
<img src="/images/thymeleaf.png"/>
<p>server side rendering</p>
<img th:src="@{/images/thymeleaf.png}"/>
</body>
</html>
```

(application.properties 先註解 context-path)  

<img width="818" height="427" alt="{14CD07C1-2262-45AD-8AFA-449B46FAEFA0}" src="https://github.com/user-attachments/assets/2a0ad7d6-3558-4370-92f5-815fe8e3af7f" />  

## 字串相加

```html
home.html

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>hello thymeleaf</h1>
<h2 style="background-color: red;" th:text="${message}"></h2>
<h2 style="background-color: blue;">[[${message}]]</h2>
<hr/>
<h1>concat string</h1>
<h2 style="background-color: red;" th:text="${message2}+' is fun'"></h2>
<h2 style="background-color: blue;">[[${message2}]] is fun</h2>

<hr/>
<p>origin</p>
<img src="/images/thymeleaf.png"/>
<p>server side rendering</p>
<img th:src="@{/images/thymeleaf.png}"/>
</body>
</html>
```

```java
DemoController.java

@Controller
public class DemoController {
    private static final String MESSAGE = "message";
    private static final String MESSAGE2 = "message2";
    @GetMapping("/")
    public String index(Model model) {
        model.addAttribute(MESSAGE,"Hi, 我是Mark Ho");
        model.addAttribute(MESSAGE2,"learning spring");
        return "home";
    }
    @GetMapping("/info")
    public String info() {
        return "info/contact";
    }
}
```

<img width="837" height="567" alt="{613B581B-625A-4E53-84A1-868C8DD8A819}" src="https://github.com/user-attachments/assets/dcd43be7-3195-46c0-913e-bc2f2e6c68f9" />

###

```java
DemoController.java

import com.uuu.demo1.beans.Course;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Controller
public class DemoController {
    private static final String MESSAGE = "message";
    private static final String MESSAGE2 = "message2";
    private static final String INFO_KEY1 = "jcourse";
    @GetMapping("/")
    public String index(Model model) {
        model.addAttribute(MESSAGE,"Hi, 我是Mark Ho");
        model.addAttribute(MESSAGE2,"learning spring");
        return "home";
    }
    @GetMapping("/info")
    public String info(Model m) {
        Course course = new Course();
        m.addAttribute(INFO_KEY1, course);
        return "info/contact";
    }
}
```

```java
Course.java (NEW)

package com.uuu.demo1.beans;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class Course {
    private String id;
    private String name;
    private String duration;
    private String fee;

}
```

```html
contact.html

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h3 th:text="${jcourse}"></h3>
<h1>如果有問題請聯絡...人</h1>
</body>
</html>
```

###

```java
DemoController.java

import com.uuu.demo1.beans.Course;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Controller
public class DemoController {
    private static final String MESSAGE = "message";
    private static final String MESSAGE2 = "message2";
    private static final String INFO_KEY1 = "jcourse";
    @GetMapping("/")
    public String index(Model model) {
        model.addAttribute(MESSAGE,"Hi, 我是Mark Ho");
        model.addAttribute(MESSAGE2,"learning spring");
        return "home";
    }
    @GetMapping("/info")
    public String info(Model m) {
        Course course = new Course();
        course.setId("SL275");
        course.setDuration("35hr");
        course.setFee("24000NTD");
        course.setName("Java and OOP");
        m.addAttribute(INFO_KEY1, course);
        return "info/contact";
    }
}
```

```html
contact.html

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h3 th:text="${jcourse}"></h3>
<ul>
    <li th:text="${jcourse.id}"></li>
    <li th:text="${jcourse.name}"></li>
    <li th:text="${jcourse.duration}"></li>
    <li th:text="${jcourse.fee}"></li>
</ul>
<h1>如果有問題請聯絡...人</h1>
</body>
</html>
```

<img width="666" height="267" alt="{3F6E3923-8D24-4870-A720-83B6C201B005}" src="https://github.com/user-attachments/assets/18139f83-142b-4fb6-b113-7eb6188c6a45" />

### 使用application.properties讀值

```properties
application.properties

spring.application.name=demo1
#server.servlet.context-path=/ucom
main.course.name=Vue 4 days, Spring Boot 4 days
```

```java
DemoController.java

import com.uuu.demo1.beans.Course;
import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Controller
@Slf4j
public class DemoController {
    private static final String MESSAGE = "message";
    private static final String MESSAGE2 = "message2";
    private static final String INFO_KEY1 = "jcourse";
    @Value("${main.course.name}")
    private String courseName;
    private static final Logger LOG = LoggerFactory.getLogger(DemoController.class);
    @GetMapping("/")
    public String index(Model model) {
        model.addAttribute(MESSAGE,"Hi, 我是Mark Ho");
        model.addAttribute(MESSAGE2,"learning spring");
        return "home";
    }
    @GetMapping("/info")
    public String info(Model m) {
        System.out.printf("course name=%s\n",courseName);
        log.info("course name={}",courseName);
        LOG.info("COURSE NAME={}",courseName);
        Course course = new Course();
        course.setId("SL275");
        course.setDuration("35hr");
        course.setFee("24000NTD");
        course.setName("Java and OOP");
        m.addAttribute(INFO_KEY1, course);
        return "info/contact";
    }
}
```
<img width="945" height="85" alt="{02DFE58A-08EE-466F-AB93-8B80794DA43A}" src="https://github.com/user-attachments/assets/b7927d55-f7f7-4e88-b667-10c7bd27af08" />

### application.properties加入新屬性

```properties
application.properties

spring.application.name=demo1
#server.servlet.context-path=/ucom
main.course.name=Vue 4 days, Spring Boot 4 days
main.course.limit=60
```

```java
DemoController.java

package com.uuu.demo1.controllers;


import com.uuu.demo1.beans.Course;
import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Controller
@Slf4j
public class DemoController {
    private static final String MESSAGE = "message";
    private static final String MESSAGE2 = "message2";
    private static final String INFO_KEY1 = "jcourse";
    @Value("${main.course.name}")
    private String courseName;
    @Value("${main.course.limit}")
    private Integer courseLimit;
    private static final Logger LOG = LoggerFactory.getLogger(DemoController.class);

    @GetMapping("/")
    public String index(Model model) {
        model.addAttribute(MESSAGE, "Hi, 我是Mark Ho");
        model.addAttribute(MESSAGE2, "learning spring");
        return "home";
    }

    @GetMapping("/info")
    public String info(Model m) {
        System.out.printf("course name=%s\n", courseName);
        log.info("course name={}, double course limit={}", courseName, courseLimit * 2);
        LOG.info("COURSE NAME={}, triple course limit={}", courseName, courseLimit * 3);
        Course course = new Course();
        course.setId("SL275");
        course.setDuration("35hr");
        course.setFee("24000NTD");
        course.setName("Java and OOP");
        m.addAttribute(INFO_KEY1, course);
        return "info/contact";
    }
}
```

### 測試案例 Tests

test資料夾下的路徑  

```
DemoTests

package com.uuu.demo1;

import org.junit.jupiter.api.*;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
public class DemoTests {
    @BeforeAll
    public static void prepareOnce() {
        System.out.println("一次性的啟動");
    }

    @AfterAll
    public static void finalCleanUp() {
        System.out.println("最後的最後收尾");
    }

    @BeforeEach
    public void prepare() {
        System.out.println("一些準備工作");
    }

    @AfterEach
    public void cleanup() {
        System.out.println("收尾");
    }

    @Test
    public void doATest() {
        System.out.println("test something first");
    }

    @Test
    public void doAnotherTest() {
        System.out.println("test something later");
    }
    @Disabled("skip1")
    @Test
    public void doATestThatNotYetImplement() {
        Assertions.fail();
    }
    @Disabled("skip2")
    @Test
    public void doATestThatNotYetImplementWithReason() {
        Assertions.fail("下一Q會實作");
    }
    @Disabled("skip3")
    @Test
    public void doATestThatHasException() {
        throw new RuntimeException();
    }
}
```

透過三角形跑案例  
<img width="677" height="409" alt="{555FD4D8-D658-4AE0-8332-4795C1822891}" src="https://github.com/user-attachments/assets/2044ae52-a2dc-40d0-b1f5-86ee88f1c1dd" />
<img width="963" height="260" alt="{3BB2A424-542F-46A0-B603-1E5343DE9D77}" src="https://github.com/user-attachments/assets/0d93e83c-98ab-4177-8546-3315b1e60a93" />


C:\Users\Admin\Desktop\spring_boots_labs\demo1> .\mvnw test  
<img width="902" height="336" alt="{C66C2BB1-263E-4A37-9F29-9A340A38DD11}" src="https://github.com/user-attachments/assets/e1b75ddc-0bc6-4a3c-b1f2-d6c8026e4b98" />  

### Demo2Test

```
Demo2Test

package com.uuu.demo1;

import com.uuu.demo1.controllers.DemoController;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
public class Demo2Test {
    @Autowired
    private DemoController controller;

    @Test
    public void checkDemoControllerNotNull() {
        Assertions.assertNotNull(controller);
    }
}
```

### Demo3Test

```
Demo3Test

package com.uuu.demo1;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.web.servlet.MockMvc;

@SpringBootTest
@AutoConfigureMockMvc
public class Demo3Test {
    @Autowired
    private MockMvc mockMvc;

    @Test
    public void checkDemoControllerNotNull() {
        Assertions.assertNotNull(mockMvc);
    }
}
```

### 加上Mock案例

```
Demo3Test

package com.uuu.demo1;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;

@SpringBootTest
@AutoConfigureMockMvc
public class Demo3Test {
    @Autowired
    private MockMvc mockMvc;

    @Test
    public void checkDemoControllerNotNull() {
        Assertions.assertNotNull(mockMvc);
    }

    @Test
    public void testHomeIsOk() throws Exception {
        mockMvc.perform(MockMvcRequestBuilders.get("/"))
                .andExpect(MockMvcResultMatchers.status().isOk());
    }

    @Test
    public void testHomeIs2XX() throws Exception {
        mockMvc.perform(MockMvcRequestBuilders.get("/"))
                .andExpect(MockMvcResultMatchers.status().is2xxSuccessful());
    }

    @Test
    public void testAdminIsNotFound() throws Exception {
        mockMvc.perform(MockMvcRequestBuilders.get("/admin"))
                .andExpect(MockMvcResultMatchers.status().isNotFound());
    }
    @Test
    public void testAdminIs4XXClientSideError() throws Exception {
        mockMvc.perform(MockMvcRequestBuilders.get("/admin"))
                .andExpect(MockMvcResultMatchers.status().is4xxClientError());
    }
}
```

