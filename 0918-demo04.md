# 0918 Practice - Demo03

### 

```java
ExplainDIRunner3.java (NEW)

package com.example.demo3.runner;

import com.example.demo3.calculator.AddCalculator;
import com.example.demo3.calculator.Calculator;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(3)
public class ExplainDIRunner3 implements CommandLineRunner {
    @Autowired
    private Calculator cal1;


    @Override
    public void run(String... args) throws Exception {
        log.info("will append at last");
        log.info("calculate 5,6 with cal1={}", cal1.calc(5, 6));
    }
}
```

```java
Foo1.java (NEW)

package com.example.demo3.explain;

import com.example.demo3.calculator.Calculator;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Getter
@NoArgsConstructor
@AllArgsConstructor
public class Foo1 {
    private int x;
    private Calculator c; // y is important, maybe can be initialized from foo1 constructor
    private int z;

    public Foo1(Calculator c) {
        this.c = c;
    }
}
```

```java
Foo2.java (NEW)

package com.example.demo3.explain;

import com.example.demo3.calculator.Calculator;
import lombok.Getter;
@Getter
public class Foo2 {
    private int x;
    private final Calculator c; // y is important, maybe can be initialized from foo1 constructor
    private int z;


    public Foo2(Calculator c) {
        this.c = c;
    }
}
```

```java
Foo3.java (NEW)

package com.example.demo3.explain;

import com.example.demo3.calculator.Calculator;
import lombok.RequiredArgsConstructor;
import lombok.Getter;
@RequiredArgsConstructor
@Getter
public class Foo3 {
    private int x;
    private final Calculator c; // y is important, maybe can be initialized from foo1 constructor
    private int z;
}
```

```java
ArgumentsTest.java (NEW src/test/java)

package com.example.demo3;

import com.example.demo3.calculator.AddCalculator;
import com.example.demo3.calculator.SubCalculator;
import com.example.demo3.explain.Foo1;
import com.example.demo3.explain.Foo2;
import com.example.demo3.explain.Foo3;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

public class ArgumentsTest {
    @Test
    public void initializeFoo1() {
        Foo1 foo1 = new Foo1();
        Assertions.assertNull(foo1.getC());

    }

    @Test
    public void initializeFoo2() {
        Foo2 foo2 = new Foo2(new SubCalculator());
        Assertions.assertEquals(2, foo2.getC().calc(4, 2));
    }

    @Test
    public void initializeFoo3() {
        Foo3 foo3 = new Foo3(new AddCalculator());
        Assertions.assertEquals(6, foo3.getC().calc(4, 2));
    }
}
```
<img width="634" height="202" alt="{F07AB8FE-3A9E-40AB-8289-9655619D2E23}" src="https://github.com/user-attachments/assets/986e41ed-8a1d-49ae-9f34-d7f046fd4b46" />

### 應該是在說 @Component

```java
Racing.java (NEW)

package com.example.demo3.race;

public interface Racing {
    public String status();
}
```

```java
Bicycle.java (NEW)

package com.example.demo3.race;

import org.springframework.stereotype.Component;

@Component
public class Bicycle implements Racing {
    @Override
    public String status() {
        return "2km/min";
    }
}
```

```java
ExplainDIRunner4.java (NEW)

package com.example.demo3.runner;

import com.example.demo3.race.Bicycle;
import com.example.demo3.race.Racing;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.context.ApplicationContext;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(4)
public class ExplainDIRunner4 implements CommandLineRunner {
    public ExplainDIRunner4(ApplicationContext context) {
        this.context = context;
    }

    private ApplicationContext context;

    @Override
    public void run(String... args) throws Exception {
        Racing r1 = context.getBean(Racing.class);
        log.info("r1={}", r1.status());
        Bicycle b1 = context.getBean(Bicycle.class);
        log.info("b1={}", b1.status());
    }
}

```

```java
ExplainDIRunner5.java (NEW)

package com.example.demo3.runner;

import com.example.demo3.race.Bicycle;
import com.example.demo3.race.Racing;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(5)
public class ExplainDIRunner5 implements CommandLineRunner {
    @Autowired
    private Racing r1;
    @Autowired
    private Bicycle b1;

    @Override
    public void run(String... args) throws Exception {
        log.info("r1={}", r1.status());
        log.info("b1={}", b1.status());
    }
}
```

### Logging

```java
ExplainLog.java (NEW)

package com.example.demo3.runner;

import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(6)
public class ExplainLog implements CommandLineRunner {
    @Override
    public void run(String... args) throws Exception {
        log.trace("this is a log");
        log.debug("this is a log");
        log.info("this is a log");
        log.warn("this is a log");
        log.error("this is a log");
    }
}
```

```properties
application.properties

spring.application.name=demo3
management.endpoints.web.exposure.include=*
#logging.level.root=trace
logging.level.root=info
logging.level.com.example.demo3.runner.ExplainLog=trace
```

<img width="1114" height="173" alt="{82AE7211-1AEA-43E5-B317-0C14B79ABB41}" src="https://github.com/user-attachments/assets/035d624f-fee3-4da8-9e1d-476dd30366d9" />


參考連結 https://docs.spring.io/spring-boot/docs/3.2.2/reference/htmlsingle/

### Bean name

```java
AppConfig .java

package com.example.demo3.config;

import com.example.demo3.calculator.AddCalculator;
import com.example.demo3.calculator.Calculator;
import com.example.demo3.calculator.SubCalculator;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AppConfig {
    @Bean(name = "add")
    public Calculator cal1() {
        return new AddCalculator();
    }

    @Bean(name = "sub")
    public Calculator cal2() {
        return new SubCalculator();
    }
}
```

```java
ExplainDIRunner1.java

package com.example.demo3.runner;

import com.example.demo3.calculator.Calculator;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.context.ApplicationContext;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(1)
public class ExplainDIRunner1 implements CommandLineRunner {
    @Autowired
    private ApplicationContext context;

    @Override
    public void run(String... args) throws Exception {
        Calculator c1 = context.getBean("add", Calculator.class);
        log.info("c1 with 1,2={}", c1.calc(1, 2));
        Calculator c2 = context.getBean("sub", Calculator.class);
        log.info("c2 with 1,2={}", c2.calc(1, 2));
    }
}
```

```java
ExplainDIRunner2.java

package com.example.demo3.runner;

import com.example.demo3.calculator.Calculator;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(2)
public class ExplainDIRunner2 implements CommandLineRunner {

    private final Calculator cal1;
    private final Calculator cal2;

    public ExplainDIRunner2(@Qualifier("add") Calculator cal1,
                            @Qualifier("sub") Calculator cal2) {
        this.cal1 = cal1;
        this.cal2 = cal2;
    }

    @Override
    public void run(String... args) throws Exception {
        log.info("calculate 3,4 with cal1={}", cal1.calc(3, 4));
        log.info("calculate 3,4 with cal2={}", cal2.calc(3, 4));
    }
}
```

```java
ExplainDIRunner3.java

package com.example.demo3.runner;

import com.example.demo3.calculator.AddCalculator;
import com.example.demo3.calculator.Calculator;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(3)
public class ExplainDIRunner3 implements CommandLineRunner {
    @Autowired
    @Qualifier("add")
    private Calculator cal1;
    @Autowired
    @Qualifier("sub")
    private Calculator cal2;


    @Override
    public void run(String... args) throws Exception {

        log.info("calculate 5,6 with cal1={}", cal1.calc(5, 6));
        log.info("calculate 5,6 with cal2={}", cal2.calc(5, 6));
    }
}
```

### @Component 多元件定義

```java
Bike.java (NEW)

package com.example.demo3.race;

import org.springframework.stereotype.Component;

@Component("bike")
public class Bike implements Racing{
    @Override
    public String status() {
        return "80km/hr";
    }
}
```

```java
Bicycle.java

package com.example.demo3.race;

import org.springframework.stereotype.Component;

@Component("bicycle")
public class Bicycle implements Racing {
    @Override
    public String status() {
        return "2km/min";
    }
}
```

```java
ExplainDIRunner4.java

package com.example.demo3.runner;

import com.example.demo3.race.Bicycle;
import com.example.demo3.race.Bike;
import com.example.demo3.race.Racing;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.context.ApplicationContext;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(4)
public class ExplainDIRunner4 implements CommandLineRunner {
    public ExplainDIRunner4(ApplicationContext context) {
        this.context = context;
    }

    private ApplicationContext context;

    @Override
    public void run(String... args) throws Exception {
        Racing r1 = context.getBean("bicycle", Racing.class);
        log.info("r1={}", r1.status());
        Bicycle b1 = context.getBean(Bicycle.class);
        log.info("b1={}", b1.status());
        Racing r2 = context.getBean("bike", Racing.class);
        log.info("r2={}", r2.status());
        Bike b2 = context.getBean(Bike.class);
        log.info("b2={}", b2.status());
    }
}
```

```java
ExplainDIRunner5.java

package com.example.demo3.runner;

import com.example.demo3.race.Bicycle;
import com.example.demo3.race.Bike;
import com.example.demo3.race.Racing;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(5)
public class ExplainDIRunner5 implements CommandLineRunner {
    @Autowired
    @Qualifier("bicycle")
    private Racing r1;
    @Autowired
    @Qualifier("bike")
    private Racing r2;
    @Autowired
    private Bicycle b1;
    @Autowired
    private Bike b2;

    @Override
    public void run(String... args) throws Exception {
        log.info("r1={}", r1.status());
        log.info("b1={}", b1.status());
        log.info("r2={}", r2.status());
        log.info("b2={}", b2.status());
    }
}
```

```java
ExplainDIRunner6.java

package com.example.demo3.runner;

import com.example.demo3.race.Bicycle;
import com.example.demo3.race.Bike;
import com.example.demo3.race.Racing;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(6)
public class ExplainDIRunner6 implements CommandLineRunner {
    public ExplainDIRunner6(@Qualifier("bicycle") Racing r1, @Qualifier("bike") Racing r2) {
        this.r1 = r1;
        this.r2 = r2;
        this.b1 = (Bicycle) r1;
        this.b2 = (Bike) r2;
    }

    private final Racing r1;
    private final Racing r2;
    private final Bicycle b1;
    private final Bike b2;

    @Override
    public void run(String... args) throws Exception {
        log.info("r1={}", r1.status());
        log.info("b1={}", b1.status());
        log.info("r2={}", r2.status());
        log.info("b2={}", b2.status());
    }
}
```

```java
ExplainDIRunner7.java

package com.example.demo3.runner;

import com.example.demo3.race.Bicycle;
import com.example.demo3.race.Bike;
import com.example.demo3.race.Racing;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(7)
public class ExplainDIRunner7 implements CommandLineRunner {
    public ExplainDIRunner7(Bicycle b1, Bike b2) {
        this.r1 = b1;
        this.r2 = b2;
        this.b1 = b1;
        this.b2 = b2;
    }

    private final Racing r1;//bicycle
    private final Racing r2;//bike
    private final Bicycle b1;
    private final Bike b2;

    @Override
    public void run(String... args) throws Exception {
        log.info("r1={}", r1.status());
        log.info("b1={}", b1.status());
        log.info("r2={}", r2.status());
        log.info("b2={}", b2.status());
    }
}
```

### bean的定義

```java
Message.java

package com.example.demo3.beans;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.stereotype.Component;

@Component
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Message {
    private int id;
    private String name;

}
```

```java
HelloController.java

package com.example.demo3.controllers;

import com.example.demo3.beans.Message;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {
    @Autowired
    private Message message;

    @GetMapping("/hello")
    Message home() {
        message.setId(888);
        message.setName("ucom");
        return message;
    }
}
```

```java
WelcomeController.java

package com.example.demo3.controllers;

import com.example.demo3.beans.Message;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class WelcomeController {
    @Autowired
    private Message message;
    @GetMapping("/welcome")
    Message home() {
        return message;
    }
}
```

message是同一個物件，當hello把他修改後，welcome也會抓到修改後的值
<img width="349" height="555" alt="{E46B80AF-8A86-4E05-A99B-64849C16FADE}" src="https://github.com/user-attachments/assets/39f83f74-e4a9-4e4a-80ea-210a81053d8a" />
<img width="382" height="561" alt="{757E9250-60E6-4780-BC67-678F19D2D8D8}" src="https://github.com/user-attachments/assets/7502ca9f-1793-4913-8aad-8d0b2106410d" />

### Java到JSON的轉換

```java
Appendix.java

package com.example.demo3.beans;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class Appendix {
    private String chapter = "default chapter";
    private String detail = "default detail";
}
```

```java
Message.java

package com.example.demo3.beans;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.stereotype.Component;

import java.util.Date;

@Component
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Message {
    private int id;
    private String name;
    private float cost;
    private boolean isValid;
    private Date date;
    private String detail;// test unicode
    private String[] referral = {"Mark", "John", "Ken"};
    private Appendix appendix = new Appendix();
}
```

```java
WelcomeController.java

package com.example.demo3.controllers;

import com.example.demo3.beans.Message;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Date;

@RestController
public class WelcomeController {
    @Autowired
    private Message message;

    @GetMapping("/welcome")
    Message home() {
        message.setCost(4.5f);
        message.setValid(true);
        message.setDate(new Date());
        message.setDetail("試試萬國碼");
        return message;
    }
}
```
<img width="421" height="670" alt="{33A8BBA5-581F-48AF-9077-6C95B00D37BF}" src="https://github.com/user-attachments/assets/e902feb8-b153-4505-aed9-495a002af1ce" />

### 改成@Scope("prototype")，給定初始值

```java
Message.java

package com.example.demo3.beans;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;

import java.util.Date;

@Component
@Scope("prototype")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Message {
    @Value("-1")
    private int id;
    @Value("default user")
    private String name;
    private float cost;
    private boolean isValid;
    private Date date;
    private String detail;// test unicode
    private String[] referral = {"Mark", "John", "Ken"};
    private Appendix appendix = new Appendix();
}
```

在hello前後，welcome結果都還是維持預設值不變(不會被hello結果所影響)
<img width="460" height="649" alt="{D00C34D7-853A-4B05-AA10-84A14E0A7A05}" src="https://github.com/user-attachments/assets/c3a5e4a0-40ed-4728-aea6-3d4da2328b33" />

### Scope "prototype" 說明 

```java
Message.java

package com.example.demo3.beans;

import lombok.*;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;

import java.util.Date;

@Component
@Scope("prototype")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class Message {
    @Value("-1")
    private int id;
    @Value("default user")
    private String name;
    private float cost;
    private boolean isValid;
    private Date date;
    private String detail;// test unicode
    private String[] referral = {"Mark", "John", "Ken"};
    private Appendix appendix = new Appendix();
}
```

```java
HelloController.java

package com.example.demo3.controllers;

import com.example.demo3.beans.Message;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@Slf4j
public class HelloController {
    @Autowired
    private Message message;

    @GetMapping("/hello")
    ResponseEntity<?> home() {
        log.info("message hash={}",message.hashCode());

        message.setId(888);
        message.setName("ucom");
        return new ResponseEntity<>(message, HttpStatus.OK);
    }
}
```

```java
WelcomeController.java

package com.example.demo3.controllers;

import com.example.demo3.beans.Message;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Date;

@RestController
@Slf4j
public class WelcomeController {
    @Autowired
    private Message message;

    @GetMapping("/welcome")
    ResponseEntity<?> home() {
        log.info("message hash={}", message.hashCode());
        message.setCost(4.5f);
        message.setValid(true);
        message.setDate(new Date());
        message.setDetail("試試萬國碼");
        return new ResponseEntity<>(message, HttpStatus.OK);
    }
}
```

<img width="1146" height="103" alt="{13D70C98-EF08-4ED6-854C-B82357B381F7}" src="https://github.com/user-attachments/assets/866137cc-18df-401e-bc42-54bc4ff7e4fa" />

### 程式碼實作

```java
Counter1.java (NEW)

package com.example.demo3.counter;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Component
@Scope("singleton")
public class Counter1 {
    private Integer value = 10;
}
```

```java
Counter2.java (NEW)

package com.example.demo3.counter;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Component
@Scope("prototype")
public class Counter2 {
    private Integer value = 20;
}
```

```java
Counter3.java (NEW)

package com.example.demo3.counter;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.stereotype.Component;
import org.springframework.web.context.annotation.RequestScope;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Component
@RequestScope
public class Counter3 {
    private Integer value=30;
}
```

```java
Counter4.java (NEW)

package com.example.demo3.counter;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.stereotype.Component;
import org.springframework.web.context.annotation.SessionScope;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Component
@SessionScope
public class Counter4 {
    private Integer value=40;
}
```

```java
Counter5.java (NEW)

package com.example.demo3.counter;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.context.annotation.Scope;
import org.springframework.context.annotation.ScopedProxyMode;
import org.springframework.stereotype.Component;
import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.annotation.ApplicationScope;
import org.springframework.web.context.annotation.SessionScope;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Component
//@ApplicationScope
@Scope(value = WebApplicationContext.SCOPE_APPLICATION,
        proxyMode = ScopedProxyMode.TARGET_CLASS)
public class Counter5 {
    private Integer value = 50;
}
```

```java
Rest1.java (NEW)

package com.example.demo3.controllers;

import com.example.demo3.counter.Counter1;
import com.example.demo3.counter.Counter2;
import com.example.demo3.counter.Counter3;
import com.example.demo3.counter.Counter5;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.HashMap;
import java.util.Map;

@RestController
public class Rest1 {
    @Autowired
    private Counter1 counter1;
    @Autowired
    private Counter2 counter2;
    @Autowired
    private Counter3 counter3;
    @Autowired
    private Counter5 counter5;

    @GetMapping("/rest1")
    public ResponseEntity<?> doRest1() {
        Map<String, Integer> result = new HashMap<>();
        counter1.setValue(counter1.getValue() + 5);
        counter2.setValue(counter2.getValue() + 5);
        counter3.setValue(counter3.getValue() + 5);
        counter5.setValue(counter5.getValue() + 5);
        result.put("[singleton]counter1", counter1.getValue());
        result.put("[prototype]counter2", counter2.getValue());
        result.put("[request]counter3", counter3.getValue());
        result.put("[application]counter5", counter5.getValue());
        return new ResponseEntity<>(result, HttpStatus.OK);
    }
}
```

```java
Rest2.java (NEW)

package com.example.demo3.controllers;

import com.example.demo3.counter.Counter1;
import com.example.demo3.counter.Counter2;
import com.example.demo3.counter.Counter3;
import com.example.demo3.counter.Counter5;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.HashMap;
import java.util.Map;

@RestController
public class Rest2 {
    @Autowired
    private Counter1 counter1;
    @Autowired
    private Counter2 counter2;
    @Autowired
    private Counter3 counter3;
    @Autowired
    private Counter5 counter5;

    @GetMapping("/rest2")
    public ResponseEntity<?> doRest1() {
        Map<String, Integer> result = new HashMap<>();
        counter1.setValue(counter1.getValue() + 5);
        counter2.setValue(counter2.getValue() + 5);
        counter3.setValue(counter3.getValue() + 5);
        counter5.setValue(counter5.getValue() + 5);
        result.put("[singleton]counter1", counter1.getValue());
        result.put("[prototype]counter2", counter2.getValue());
        result.put("[request]counter3", counter3.getValue());
        result.put("[application]counter5", counter5.getValue());
        return new ResponseEntity<>(result, HttpStatus.OK);
    }
}
```
#### prototype(2)會各自獨立，Request(3)每次會重新初始計算，singleton(1)跟Application(5)會是兩區共用

### 使用MVC

```html
list.html (NEW)

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>list variable</title>
</head>
<body>
<h2>counter1=[[${c1}]]</h2>
<h2>counter2=[[${c2}]]</h2>
<h2>counter3=[[${c3}]]</h2>
<h2>counter4=[[${c4}]]</h2>
<h2>counter5=[[${c5}]]</h2>
</body>
</html>
```

```java
Controller1.java (NEW)

package com.example.demo3.controllers;

import com.example.demo3.counter.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class Controller1 {
    @Autowired
    private Counter1 counter1;
    @Autowired
    private Counter2 counter2;
    @Autowired
    private Counter3 counter3;
    @Autowired
    private Counter4 counter4;
    @Autowired
    private Counter5 counter5;

    @GetMapping("/list1")
    public String list(Model model) {
        counter1.setValue(counter1.getValue() + 1);
        counter2.setValue(counter2.getValue() + 1);
        counter3.setValue(counter3.getValue() + 1);
        counter4.setValue(counter4.getValue() + 1);
        counter5.setValue(counter5.getValue() + 1);
        model.addAttribute("c1", counter1);
        model.addAttribute("c2", counter2);
        model.addAttribute("c3", counter3);
        model.addAttribute("c4", counter4);
        model.addAttribute("c5", counter5);

        return "list";
    }
}
```

```java
Controller2.java (NEW)

package com.example.demo3.controllers;

import com.example.demo3.counter.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class Controller2 {
    @Autowired
    private Counter1 counter1;
    @Autowired
    private Counter2 counter2;
    @Autowired
    private Counter3 counter3;
    @Autowired
    private Counter4 counter4;
    @Autowired
    private Counter5 counter5;

    @GetMapping("/list2")
    public String list(Model model) {
        counter1.setValue(counter1.getValue() + 1);
        counter2.setValue(counter2.getValue() + 1);
        counter3.setValue(counter3.getValue() + 1);
        counter4.setValue(counter4.getValue() + 1);
        counter5.setValue(counter5.getValue() + 1);
        model.addAttribute("c1", counter1);
        model.addAttribute("c2", counter2);
        model.addAttribute("c3", counter3);
        model.addAttribute("c4", counter4);
        model.addAttribute("c5", counter5);

        return "list";
    }
}
```

#### 結果同前，增加了(4)session，使用不同瀏覽器可以看出差異
<img width="1308" height="472" alt="{8B8E8A54-1D33-404A-89D4-D8DE144DB6AF}" src="https://github.com/user-attachments/assets/c5598636-cb28-45f4-b9d5-db667d6540af" />

### 實作Session

```html
session_list.html (NEW)

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<a href="./session2">go to session2</a>
</body>
</html>
```

```html
session_result.html (NEW)

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h2>key1=[[${key1}]]</h2>
</body>
</html>
```

```java
Controller3.java (NEW)

package com.example.demo3.controllers;

import jakarta.servlet.http.HttpSession;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class Controller3 {
    @GetMapping("/session1")
    public String session1(HttpSession session) {
        session.setAttribute("key1", "abcde12345");
        return "session_list";
    }
}
```

```java
Controller4.java (NEW)

package com.example.demo3.controllers;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.SessionAttribute;

@Controller
public class Controller4 {
    @GetMapping("/session2")
    public String session2(Model model, @SessionAttribute("key1") String key1) {
        model.addAttribute("key1", key1);
        return "session_result";
    }
}
```

必須先做完session1，有設定session後，用session2才抓的到session的key
<img width="745" height="401" alt="{F2C39721-F648-49E5-A48E-6AEF9A967983}" src="https://github.com/user-attachments/assets/9e288aa8-db62-46d5-aed5-473abfe77ead" />
<img width="347" height="150" alt="{D6115DC7-0760-49A6-85C1-3F0ED1D2857E}" src="https://github.com/user-attachments/assets/aee66ef3-eb1c-4d82-ae65-07246f02f302" />
