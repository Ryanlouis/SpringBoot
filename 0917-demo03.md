# 0917 Practice - Demo03

### 開啟Spring Initializr 建立專案  

* 填寫專案相關資訊：Group、Artifact、Name、Package name

* 引入相關的Dependencies  
* 下方Generate下載專案
* https://start.spring.io/#!type=maven-project&language=java&platformVersion=3.5.5&packaging=jar&jvmVersion=17&groupId=com.example&artifactId=demo3&name=demo3&description=Demo%20project%20for%20Spring%20Boot&packageName=com.example.demo3&dependencies=devtools,lombok,web,thymeleaf,actuator

### RestController API

```java
RestController1.java

package com.example.demo3.controllers;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class RestController1 {
    @RequestMapping(path = "/", method = RequestMethod.GET)
    String getHome() {
        return "[GET]Hello World";
    }

    @RequestMapping(path = "/", method = RequestMethod.POST)
    String postHome() {
        return "[POST]Hello World";
    }
}
```

<img width="280" height="186" alt="{70506706-C87F-44E7-A046-6184E79AC5D2}" src="https://github.com/user-attachments/assets/3b47f84f-012f-4379-8a65-95331783120e" />
<img width="703" height="496" alt="{45BDC58E-71D5-4653-AF04-5FC73608B812}" src="https://github.com/user-attachments/assets/4236d786-2fd3-4dc6-b453-97e35f266ddf" />

### 設定IDE 自動編譯 & Reload

> Advanced Settings
<img width="984" height="735" alt="2025-09-17 15_58_49-Settings" src="https://github.com/user-attachments/assets/a255ff55-055b-48ba-a4f7-8cdadc9b0ea9" />

>Build, Execution, Deployment > Compilers
<img width="984" height="735" alt="2025-09-17 16_00_09-Settings" src="https://github.com/user-attachments/assets/864d05c8-cff5-459e-abe2-88cbabf4a802" />

### 參數傳遞準備

```java
GreetingController.java

package com.example.demo3.controllers;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class GreetingController {
    @RequestMapping("/greeting")
    public String greeting(Model model, String n) {
        n = "ucom";
        model.addAttribute("name", n);
        return "greeting";
    }
}
```

```html
greeting.html

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>Greeting Page</h1>
<h2>Hi, [[${name}]]</h2>
</body>
</html>
```

<img width="346" height="198" alt="{76637071-437B-495E-90AE-E0A52E006665}" src="https://github.com/user-attachments/assets/a5225a30-c230-452e-9ba7-51cbbef98d72" />

### 透過 @RequestParam 傳遞參數

```java
GreetingController.java

package com.example.demo3.controllers;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class GreetingController {
    @RequestMapping("/greeting")
    public String greeting(Model model,
                           @RequestParam(value = "name", required = false, defaultValue = "ucom 14f") String n) {
        //n = "ucom";
        model.addAttribute("name", n);
        return "greeting";
    }
}
```

<img width="396" height="183" alt="{46EFC1EC-31CB-4B29-A5F0-1FD419BE4F02}" src="https://github.com/user-attachments/assets/f5216121-eb63-40d2-9f92-ba8c2314a3fb" />
<img width="523" height="182" alt="{058E6519-0E0E-4A0D-9D35-BF6795D2E5E6}" src="https://github.com/user-attachments/assets/7a37b780-83f2-41ba-ba31-a0070b5f8c30" />

### Depandency Injection實作初始

```java
Calculator.java

package com.example.demo3.calculator;

public interface Calculator {
    public int calc(int a, int b);
}
```

```java
AddCalculator.java

package com.example.demo3.calculator;

public class AddCalculator implements Calculator {
    @Override
    public int calc(int a, int b) {
        return a + b;
    }
}
```

```java
AppConfig.java

package com.example.demo3.config;

import com.example.demo3.calculator.AddCalculator;
import com.example.demo3.calculator.Calculator;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AppConfig {
    @Bean
    public Calculator cal1() {
        return new AddCalculator();
    }
}
```

<img width="263" height="296" alt="{9FA9149F-3574-45C7-91A0-E4AF2E625412}" src="https://github.com/user-attachments/assets/a586d7a2-c856-4b53-8fd8-6dffffd21efd" />

### 建立runner子套件下的ExplainDIRunner

```java
ExplainDIRunner1.java

package com.example.demo3.runner;

import com.example.demo3.calculator.Calculator;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.context.ApplicationContext;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(1)
public class ExplainDIRunner1 implements CommandLineRunner {
    @Autowired
    private ApplicationContext context;

    @Override
    public void run(String... args) throws Exception {
        Calculator c1 = context.getBean(Calculator.class);
        log.info("c1 with 1,2={}", c1.calc(1, 2));
    }
}
```

```java
SubCalculator.java

package com.example.demo3.calculator;

public class SubCalculator implements Calculator {
    @Override
    public int calc(int a, int b) {
        return a - b;
    }
}
```

```java
AppConfig.java

package com.example.demo3.config;

import com.example.demo3.calculator.AddCalculator;
import com.example.demo3.calculator.Calculator;
import com.example.demo3.calculator.SubCalculator;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AppConfig {
//    @Bean
//    public Calculator cal1() {
//        return new AddCalculator();
//    }

    @Bean
    public Calculator cal2() {
        return new SubCalculator();
    }
}
```
兩個 Calculator 同時存在，ExplainDIRunner1會不知道該找哪個 Calculator物件
<img width="980" height="358" alt="{520D40F5-D3B9-4776-A46A-591E828B7E56}" src="https://github.com/user-attachments/assets/952933b3-85d8-4150-8896-28250bbf440f" />

### 透過建構子取得

```java
ExplainDIRunner2.java

package com.example.demo3.runner;

import com.example.demo3.calculator.Calculator;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Slf4j
@Order(2)
public class ExplainDIRunner2 implements CommandLineRunner {
//    public ExplainDIRunner2(Calculator cal1) {
//        this.cal1 = cal1;
//    }

    private final Calculator cal1; //Alt + Insert 會自動帶出下面那段建構子

    public ExplainDIRunner2(Calculator cal1) {
        this.cal1 = cal1;
    }

    @Override
    public void run(String... args) throws Exception {
        log.info("calculate 3,4 with cal1={}", cal1.calc(3, 4));
    }
}
```

<img width="927" height="112" alt="{F83B874B-9B17-40EB-A9B4-3950E4C52167}" src="https://github.com/user-attachments/assets/0d113991-1f1f-47e6-9dde-9f9548309088" />
