# 0917 Practice - Demo02

### 開啟Spring Initializr 建立專案  

* 填寫專案相關資訊：Group、Artifact、Name、Package name
* 
* 引入相關的Dependencies  
* 下方Generate下載專案
* https://start.spring.io/#!type=maven-project&language=java&platformVersion=3.5.5&packaging=jar&jvmVersion=17&groupId=com.example&artifactId=demo2&name=demo2&description=Demo%20project%20for%20Spring%20Boot&packageName=com.example.demo2&dependencies=devtools,lombok,web

### pom.xml 新增 <resources>、<profiles>

```xml

<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>3.5.5</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.example</groupId>
	<artifactId>demo2</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>demo2</name>
	<description>Demo project for Spring Boot</description>
	<url/>
	<licenses>
		<license/>
	</licenses>
	<developers>
		<developer/>
	</developers>
	<scm>
		<connection/>
		<developerConnection/>
		<tag/>
		<url/>
	</scm>
	<properties>
		<java.version>17</java.version>
	</properties>
	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-devtools</artifactId>
			<scope>runtime</scope>
			<optional>true</optional>
		</dependency>
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<optional>true</optional>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<configuration>
					<annotationProcessorPaths>
						<path>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
						</path>
					</annotationProcessorPaths>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
				<configuration>
					<excludes>
						<exclude>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
						</exclude>
					</excludes>
				</configuration>
			</plugin>
		</plugins>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
            </resource>
        </resources>
	</build>
    <profiles>
        <profile>
            <id>dev</id>
        </profile>
        <profile>
            <id>prod</id>
        </profile>
        <profile>
            <id>inner</id>
        </profile>
    </profiles>
</project>
```

### 增加<profile>內部設定及預設值

```xml
pom.xml

<profiles>
        <profile>
            <id>dev</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <properties>
                <activatedProperties>dev</activatedProperties>
            </properties>
        </profile>
        <profile>
            <id>prod</id>
            <properties>
                <activatedProperties>prod</activatedProperties>
            </properties>
        </profile>
        <profile>
            <id>inner</id>
            <properties>
                <activatedProperties>inner</activatedProperties>
            </properties>
        </profile>
    </profiles>
```
<img width="1026" height="774" alt="{F91E8AAF-6BE0-44B3-8151-D7DE2FD75977}" src="https://github.com/user-attachments/assets/9f6a7ede-a8a7-415b-913b-f94417aca93f" />

```properties
application.properties

spring.application.name=demo2
spring.profiles.active=@activatedProperties@
```
<img width="1063" height="175" alt="{DDAD2E5D-9384-4389-9F1C-1EF34D0D31A2}" src="https://github.com/user-attachments/assets/842e78e5-26e0-49f0-8587-6860ec8732c0" />

### log印出profile

```java
PropertyCheckRunner.java

package com.example.demo2.runner;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
@Slf4j
public class PropertyCheckRunner implements CommandLineRunner {
    @Value("${spring.profiles.active}")
    private String profile;

    @Override
    public void run(String... args) throws Exception {
        log.info("spring的profile是:{}", profile);
    }
}
```
<img width="1063" height="309" alt="{9036E734-9613-49B2-8448-358482F277AF}" src="https://github.com/user-attachments/assets/d90bb1c5-02ca-4725-b9d7-c8f442776721" />

### 多個有-的application.properties

```properties
application.properties

spring.application.name=demo2
spring.profiles.active=@activatedProperties@
greeting=default
```

新增三個application-XXXXX.properties
```properties
application-dev.properties

greeting=something like internal dev
```

```properties
application-inner.properties

greeting=for inner testing purpose
```

```properties
application-prod.properties

greeting=use with production, caution!
```

```java
PropertyCheckRunner.java

package com.example.demo2.runner;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
@Slf4j
public class PropertyCheckRunner implements CommandLineRunner {
    @Value("${spring.profiles.active}")
    private String profile;
    @Value("${greeting}")
    private String greeting;

    @Override
    public void run(String... args) throws Exception {
        log.info("spring的profile是:{}", profile);
        log.info("greeting的值是:{}", greeting);
    }
}
```
<img width="1064" height="117" alt="{4603B9B5-8A11-4BFF-8D19-451D81AF5DC0}" src="https://github.com/user-attachments/assets/461c1064-f8a2-4e5d-a881-add95851a235" />
<img width="246" height="183" alt="{1FC9E20B-D023-4678-9C45-F36B902DCE58}" src="https://github.com/user-attachments/assets/5374bcf7-103d-4d97-b5f1-f8dab0f904f7" />

### 本機透過指令起服務

* 起服務
.\mvnw spring-boot:run  

* 指定環境別  
 .\mvnw -Pinner package
 java -jar .\target\demo2-0.0.1-SNAPSHOT.jar

* 包image，透過docker啟動
.\mvnw -Pprod spring-boot:build-image
docker run demo2:0.0.1-SNAPSHOT

* 若有遇到log需顯示中文，可透過指令改編碼
docker run  -e JAVA_OPTS="-Dfile.encoding=UTF-8" demo2:0.0.1-SNAPSHOT

<img width="1059" height="132" alt="{F4F652E7-BAB6-46B9-9330-8B3534788605}" src="https://github.com/user-attachments/assets/348fd156-4885-46db-825d-2a5a44c51a98" />
